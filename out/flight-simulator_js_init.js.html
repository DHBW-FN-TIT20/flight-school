<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: flight-simulator/js/init.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: flight-simulator/js/init.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Initializes the flight simulator game
 */
async function init() {

    // add a loading div
    const loadingDiv = document.createElement("div");
    loadingDiv.id = "loading";
    loadingDiv.innerHTML = "Loading...";
    document.body.appendChild(loadingDiv);

    // add a div for the score
    const scoreDiv = document.createElement("div");
    scoreDiv.id = "score";
    scoreDiv.innerHTML = "Score: 0";
    scoreDiv.style.position = "absolute";
    scoreDiv.style.top = "10px";
    scoreDiv.style.left = "10px";
    scoreDiv.style.color = "white";
    scoreDiv.style.fontSize = "2em";
    document.body.appendChild(scoreDiv);

    // add a div for the time
    const timeDiv = document.createElement("div");
    timeDiv.id = "time";
    timeDiv.innerHTML = "Time left: " + timeLeft;
    timeDiv.style.position = "absolute";
    timeDiv.style.top = "10px";
    timeDiv.style.right = "10px";
    timeDiv.style.color = "white";
    timeDiv.style.fontSize = "2em";
    document.body.appendChild(timeDiv);

    // add a div for telling the user to not fly out of bounds
    const outOfBoundsDiv = document.createElement("div");
    outOfBoundsDiv.id = "outOfBounds";
    outOfBoundsDiv.innerHTML = "Don't fly out of bounds!";
    outOfBoundsDiv.style.position = "absolute";
    outOfBoundsDiv.style.top = "10px";
    outOfBoundsDiv.style.left = "50%";
    outOfBoundsDiv.style.transform = "translateX(-50%)";
    outOfBoundsDiv.style.color = "red";
    outOfBoundsDiv.style.fontSize = "2em";
    outOfBoundsDiv.style.display = "none";
    document.body.appendChild(outOfBoundsDiv);

    // config for three.js
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
    );
    renderer = new THREE.WebGLRenderer();
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap

    // resize the renderer when the window is resized
    window.addEventListener("resize", () => {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
    });
    renderer.setSize(window.innerWidth, window.innerHeight);

    // enable THREEx dom events
    domEvents = new THREEx.DomEvents(camera, renderer.domElement);

    // add a clock
    clock = new THREE.Clock();
    deltaTime = 0;

    // add the renderer to the dom
    camera.position.set(4, 8, 17);

    placeTorusObjects();
    placeObstaclesObjects();

    // add a point light to the top of the scene
    const pointLight = new THREE.PointLight(0xffffff, 1, 1000);
    pointLight.position.set(0, torusSpawnRadius + 10, 0);
    scene.add(pointLight);
    scene.background = new THREE.Color(0x330000);

    // init ocean and sky
    await initOceanAndSky();

    // add the plane
    await initFlying();
    startTime = new Date().getTime();
    checkForPlaneCollision = false;

    // move the plane outside the torus radius
    sceneObjects.modelPlane.position.set(0, 5, torusSpawnRadius * 0.5 + 5,);

    // add event listener on mouse down to speed up the plane by 100%
    window.addEventListener("mousedown", () => {
        distancePerFly = distancePerFly * 2;
    });

    // add event listener on mouse up to slow down the plane by 50%
    window.addEventListener("mouseup", () => {
        distancePerFly = distancePerFly / 2;
    });

    // TEMP add event listerner to redirect to homepage at pressing f
    window.addEventListener("keydown", (e) => {
        if (e.key === "f") {
            location.href = "/?redirect-from=flight-simulator";
        }

        if (e.key === "i") {
            invertedControls = !invertedControls;
        }
    });

    // add event listener to pause the game
    window.addEventListener("keydown", (e) => {
        if (e.key === "p") {
            if (isFlying) {
                isFlying = false;
                document.getElementById("time").innerHTML = "Paused";
            } else {
                isFlying = true;
            }
        }
    });

    // add the canvas and remove the loading div
    document.body.appendChild(renderer.domElement);
    document.body.removeChild(loadingDiv);

}


/**
 * Initializes the ocean and sky
 * This code and the textures are directly from three.js
 */
async function initOceanAndSky() {

    // sun
    sun = new THREE.Vector3();
    const waterGeometry = new THREE.PlaneGeometry(10000, 10000);

    // water
    water = new THREE.Water(
        waterGeometry, {
        textureWidth: 512,
        textureHeight: 512,
        waterNormals: new THREE.TextureLoader().load('../textures/waternormals.jpg', function (texture) { texture.wrapS = texture.wrapT = THREE.RepeatWrapping; }),
        sunDirection: new THREE.Vector3(),
        sunColor: 0xffffff,
        waterColor: 0x001e0f,
        distortionScale: 3.7,
        fog: scene.fog !== undefined
    }
    );
    water.rotation.x = - Math.PI / 2;
    scene.add(water);

    // sky
    const sky = new THREE.Sky();
    sky.scale.setScalar(10000);
    scene.add(sky);
    const parameters = {
        elevation: 0.4,
        azimuth: 180
    };
    const pmremGenerator = new THREE.PMREMGenerator(renderer);
    let renderTarget;
    const phi = THREE.MathUtils.degToRad(90 - parameters.elevation);
    const theta = THREE.MathUtils.degToRad(parameters.azimuth);
    sun.setFromSphericalCoords(1, phi, theta);
    sky.material.uniforms['sunPosition'].value.copy(sun);
    water.material.uniforms['sunDirection'].value.copy(sun).normalize();
    if (renderTarget !== undefined) renderTarget.dispose();
    renderTarget = pmremGenerator.fromScene(sky);
    scene.environment = renderTarget.texture;

}


/**
 * Quits the game and shows a game over message TODO: add a ui for this
 */
function gameOver() {

    // remove all event listeners
    window.removeEventListener("mousedown", () => {
        distancePerFly = distancePerFly * 2;
    });
    window.removeEventListener("mouseup", () => {
        distancePerFly = distancePerFly / 2;
    });

    // remove the plane
    scene.remove(sceneObjects.modelPlane);

    // stop the game
    isFlying = false;

    // set cursor to default
    document.body.style.cursor = "pointer";

    // show game over message and score in the middle of the screen
    const gameOverDiv = document.createElement("div");
    gameOverDiv.id = "gameOverDiv";
    gameOverDiv.innerHTML = "Game over! &lt;/br> Your score is: " + torusScore;
    gameOverDiv.style.position = "absolute";
    gameOverDiv.style.top = "50%";
    gameOverDiv.style.left = "50%";
    gameOverDiv.style.transform = "translate(-50%, -50%)";
    gameOverDiv.style.fontSize = "50px";
    gameOverDiv.style.fontFamily = "Arial";
    gameOverDiv.style.color = "white";
    gameOverDiv.style.cursor = "pointer";
    gameOverDiv.style.textAlign = "center";

    document.body.appendChild(gameOverDiv);

    // show restart button
    const restartButton = document.createElement("button");
    restartButton.id = "restartButton";
    restartButton.innerHTML = "Restart";
    restartButton.style.position = "absolute";
    restartButton.style.top = "50%";
    restartButton.style.left = "50%";
    restartButton.style.transform = "translate(-50%, -50%)";
    restartButton.style.fontSize = "50px";
    restartButton.style.fontFamily = "Arial";
    restartButton.style.color = "white";
    restartButton.style.backgroundColor = "black";
    restartButton.style.border = "none";
    restartButton.style.padding = "20px";
    restartButton.style.cursor = "pointer";
    restartButton.style.marginTop = "100px";
    restartButton.onclick = () => {
        location.reload();
    }
    document.body.appendChild(restartButton);

    // show a exit button
    const exitButton = document.createElement("button");
    exitButton.id = "exitButton";
    exitButton.innerHTML = "Exit Flight Simulator";
    exitButton.style.position = "absolute";
    exitButton.style.top = "50%";
    exitButton.style.left = "50%";
    exitButton.style.transform = "translate(-50%, -50%)";
    exitButton.style.fontSize = "50px";
    exitButton.style.fontFamily = "Arial";
    exitButton.style.color = "white";
    exitButton.style.backgroundColor = "black";
    exitButton.style.border = "none";
    exitButton.style.padding = "20px";
    exitButton.style.cursor = "pointer";
    exitButton.style.marginTop = "200px";
    exitButton.onclick = () => {
        location.href = "/?redirect-from=flight-simulator";
    }
    document.body.appendChild(exitButton);


}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#animate">animate</a></li><li><a href="global.html#checkCollision">checkCollision</a></li><li><a href="global.html#checkForPlaneCollision">checkForPlaneCollision</a></li><li><a href="global.html#checkIfPointIsInsideMesh">checkIfPointIsInsideMesh</a></li><li><a href="global.html#createCrosshair">createCrosshair</a></li><li><a href="global.html#createModelPlane">createModelPlane</a></li><li><a href="global.html#createPlayer">createPlayer</a></li><li><a href="global.html#degToRad">degToRad</a></li><li><a href="global.html#distanceOfCameraFromPlane">distanceOfCameraFromPlane</a></li><li><a href="global.html#distancePerFly">distancePerFly</a></li><li><a href="global.html#gameOver">gameOver</a></li><li><a href="global.html#getAllMeshsFromNestedGroup">getAllMeshsFromNestedGroup</a></li><li><a href="global.html#getCameraLookAt">getCameraLookAt</a></li><li><a href="global.html#getHeightOfMesh">getHeightOfMesh</a></li><li><a href="global.html#getMashFromBlenderModel">getMashFromBlenderModel</a></li><li><a href="global.html#getNewPosition">getNewPosition</a></li><li><a href="global.html#handleAnimateChairs">handleAnimateChairs</a></li><li><a href="global.html#handleAnimateClosets">handleAnimateClosets</a></li><li><a href="global.html#handleFlying">handleFlying</a></li><li><a href="global.html#handleInfoDiv">handleInfoDiv</a></li><li><a href="global.html#handlePlaneOutOfBounds">handlePlaneOutOfBounds</a></li><li><a href="global.html#handleScore">handleScore</a></li><li><a href="global.html#handleTime">handleTime</a></li><li><a href="global.html#handleWalking">handleWalking</a></li><li><a href="global.html#infoDiv">infoDiv</a></li><li><a href="global.html#infoStartTime">infoStartTime</a></li><li><a href="global.html#infoTable">infoTable</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initAdjustBlackboardHeight">initAdjustBlackboardHeight</a></li><li><a href="global.html#initDevControls">initDevControls</a></li><li><a href="global.html#initFlying">initFlying</a></li><li><a href="global.html#initInfoDiv">initInfoDiv</a></li><li><a href="global.html#initInteractions">initInteractions</a></li><li><a href="global.html#initMouseClickMove">initMouseClickMove</a></li><li><a href="global.html#initOceanAndSky">initOceanAndSky</a></li><li><a href="global.html#initOpenCloset">initOpenCloset</a></li><li><a href="global.html#initPutChairOnTable">initPutChairOnTable</a></li><li><a href="global.html#initStartScreen">initStartScreen</a></li><li><a href="global.html#initStats">initStats</a></li><li><a href="global.html#initSwitchLight">initSwitchLight</a></li><li><a href="global.html#initTriggerFlightSimulator">initTriggerFlightSimulator</a></li><li><a href="global.html#initWalk">initWalk</a></li><li><a href="global.html#meshIsChildOf">meshIsChildOf</a></li><li><a href="global.html#placeObjects">placeObjects</a></li><li><a href="global.html#placeObstaclesObjects">placeObstaclesObjects</a></li><li><a href="global.html#placeTorusObjects">placeTorusObjects</a></li><li><a href="global.html#planeStartPoint">planeStartPoint</a></li><li><a href="global.html#putStartScreenOnReady">putStartScreenOnReady</a></li><li><a href="global.html#removeCrosshair">removeCrosshair</a></li><li><a href="global.html#showBoundingBox">showBoundingBox</a></li><li><a href="global.html#startScene">startScene</a></li><li><a href="global.html#turnVectorAroundHorizontalAxis">turnVectorAroundHorizontalAxis</a></li><li><a href="global.html#turnVectorAroundVerticalAxis">turnVectorAroundVerticalAxis</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sat Nov 12 2022 13:59:58 GMT+0100 (Mitteleuropäische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
