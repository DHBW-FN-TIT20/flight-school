<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js/init.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: js/init.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// @ts-check

async function init() {

  const urlParams = new URLSearchParams(window.location.search);
  const redirect = urlParams.get("redirect-from");
  if (redirect === "flight-simulator") redirectFromFlightSimulator = true;

  initStartScreen();

  // config for three.js
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  );
  renderer = new THREE.WebGLRenderer();
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap

  // resize the renderer when the window is resized
  window.addEventListener("resize", () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
  });
  renderer.setSize(window.innerWidth, window.innerHeight);

  // enable THREEx dom events
  domEvents = new THREEx.DomEvents(camera, renderer.domElement);

  // add a clock
  clock = new THREE.Clock();

  // add the renderer to the dom
  camera.position.set(4, 8, 17);

  // place all objects/lights and enable its interactions
  await placeObjects();
  placeLights();
  initInteractions();

  // enable walking with the keyboard
  initWalk();

  // enable orientation controls
  initMouseClickMove();

  // init stats and gui
  initStats();
  initDevControls();

  // if the user was redirected from the flight simulator look at the monitor
  if (redirectFromFlightSimulator) {
    redirectFromFlightSimulator = true;
    sceneObjects.player.position.set(3.6, sceneObjects.player.position.y, 1.5);
    camera.lookAt(sceneObjects.monitor.position.x, -10, 100);
    camera.updateProjectionMatrix()
    window.history.replaceState({}, document.title, "/");
  }

  const startImmediately = putStartScreenOnReady();

  if (!startImmediately) {

    // wait till the user clicks on the start button or presses enter
    await new Promise((resolve) => {
      document.getElementById("start-button").addEventListener("click", () => {
        startScene();
        resolve();
      });
      window.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          startScene();
          resolve();
        }
      });
    });
  } else {
    startScene();
  }

}


/**
 * Initialize the FPS stats
 */
function initStats() {
  stats = new Stats();
  stats.setMode(0);

  stats.domElement.style.position = 'absolute';
  stats.domElement.style.left = '0';
  stats.domElement.style.top = '50px';
  stats.domElement.id = "stats";
  stats.domElement.style.display = "none";
  document.body.appendChild(stats.domElement);
}


/**
 * Initialize developer controls and experimental features
 * such as the ability to turn on/off all lights by pressing l
 * or the ability to turn on/off shadows of the chairs by pressing c
 */
function initDevControls() {

  window.addEventListener("keydown", event => {
    switch (event.key) {

      case "l":
      case "L":

        sceneObjects.bulbLights.forEach(light => light.visible = !light.visible);

        break;

      case "j":
      case "J":

        // toggle stats visibility
        stats.domElement.style.display = stats.domElement.style.display === "none" ? "block" : "none";

        break;

      case "c":
      case "C":

        [...sceneObjects.chairs, sceneObjects.profChair].forEach((chair) => {
          chair.traverse((child) => { child.castShadow = !child.castShadow; });
        });

        break;

      case "h":
      case "H":

        // toggle help screen visibility
        document.getElementById("start-screen").style.display = document.getElementById("start-screen").style.display === "none" ? "block" : "none";
        break;

      case "j":
      case "J":

        // toggle stats visibility
        stats.domElement.style.display = stats.domElement.style.display === "none" ? "block" : "none";

        break;
    }
  });

}


/**
 * Initialize the start screen / landing page (no js needed so far)
 */
function initStartScreen() {}


/**
 * Hides the start screen and starts the scene
 */
function startScene() {
  document.body.appendChild(renderer.domElement);
  document.getElementById("start-screen").style.display = "none";
  document.getElementById("stats").style.display = "block";
}


/**
 * Sets the button from "Loading..." to "Start" and enables it
 * @returns {boolean} true if the start button should be clicked immediately (if the user was redirected from the flight simulator)
 */
function putStartScreenOnReady() {

  // remove the loading icon
  document.getElementById("loading-icon").style.display = "none";

  if (redirectFromFlightSimulator) return true;

  // change button text to "Start" and enable the button
  document.getElementById("start-button").innerText = "Start";
  document.getElementById("start-button").removeAttribute("disabled");

  return false;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#animate">animate</a></li><li><a href="global.html#checkCollision">checkCollision</a></li><li><a href="global.html#checkForPlaneCollision">checkForPlaneCollision</a></li><li><a href="global.html#checkIfPointIsInsideMesh">checkIfPointIsInsideMesh</a></li><li><a href="global.html#createCrosshair">createCrosshair</a></li><li><a href="global.html#createModelPlane">createModelPlane</a></li><li><a href="global.html#createPlayer">createPlayer</a></li><li><a href="global.html#degToRad">degToRad</a></li><li><a href="global.html#distanceOfCameraFromPlane">distanceOfCameraFromPlane</a></li><li><a href="global.html#distancePerFly">distancePerFly</a></li><li><a href="global.html#gameOver">gameOver</a></li><li><a href="global.html#getAllMeshsFromNestedGroup">getAllMeshsFromNestedGroup</a></li><li><a href="global.html#getCameraLookAt">getCameraLookAt</a></li><li><a href="global.html#getHeightOfMesh">getHeightOfMesh</a></li><li><a href="global.html#getMashFromBlenderModel">getMashFromBlenderModel</a></li><li><a href="global.html#getNewPosition">getNewPosition</a></li><li><a href="global.html#handleAnimateChairs">handleAnimateChairs</a></li><li><a href="global.html#handleAnimateClosets">handleAnimateClosets</a></li><li><a href="global.html#handleFlying">handleFlying</a></li><li><a href="global.html#handleInfoDiv">handleInfoDiv</a></li><li><a href="global.html#handlePlaneOutOfBounds">handlePlaneOutOfBounds</a></li><li><a href="global.html#handleScore">handleScore</a></li><li><a href="global.html#handleTime">handleTime</a></li><li><a href="global.html#handleWalking">handleWalking</a></li><li><a href="global.html#infoDiv">infoDiv</a></li><li><a href="global.html#infoStartTime">infoStartTime</a></li><li><a href="global.html#infoTable">infoTable</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initAdjustBlackboardHeight">initAdjustBlackboardHeight</a></li><li><a href="global.html#initDevControls">initDevControls</a></li><li><a href="global.html#initFlying">initFlying</a></li><li><a href="global.html#initInfoDiv">initInfoDiv</a></li><li><a href="global.html#initInteractions">initInteractions</a></li><li><a href="global.html#initMouseClickMove">initMouseClickMove</a></li><li><a href="global.html#initOceanAndSky">initOceanAndSky</a></li><li><a href="global.html#initOpenCloset">initOpenCloset</a></li><li><a href="global.html#initPutChairOnTable">initPutChairOnTable</a></li><li><a href="global.html#initStartScreen">initStartScreen</a></li><li><a href="global.html#initStats">initStats</a></li><li><a href="global.html#initSwitchLight">initSwitchLight</a></li><li><a href="global.html#initTriggerFlightSimulator">initTriggerFlightSimulator</a></li><li><a href="global.html#initWalk">initWalk</a></li><li><a href="global.html#meshIsChildOf">meshIsChildOf</a></li><li><a href="global.html#placeObjects">placeObjects</a></li><li><a href="global.html#placeObstaclesObjects">placeObstaclesObjects</a></li><li><a href="global.html#placeTorusObjects">placeTorusObjects</a></li><li><a href="global.html#planeStartPoint">planeStartPoint</a></li><li><a href="global.html#putStartScreenOnReady">putStartScreenOnReady</a></li><li><a href="global.html#removeCrosshair">removeCrosshair</a></li><li><a href="global.html#showBoundingBox">showBoundingBox</a></li><li><a href="global.html#startScene">startScene</a></li><li><a href="global.html#turnVectorAroundHorizontalAxis">turnVectorAroundHorizontalAxis</a></li><li><a href="global.html#turnVectorAroundVerticalAxis">turnVectorAroundVerticalAxis</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sat Nov 12 2022 13:59:58 GMT+0100 (Mitteleurop√§ische Normalzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
